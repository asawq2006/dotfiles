#!/usr/bin/env ruby
#
# package manager for vim plugins.
# by jm3 / john manoogian III / 2013
# freshens existing plugins
# clones new plugins from remote git repos
# remove plugins no longer referenced here

# add urls to the source of any vim plugin you'd like to use
bundle_repo_urls = [
  "git://github.com/jelera/vim-gummybears-colorscheme", # fun colors
  "git://github.com/altercation/vim-colors-solarized",  # sane, modern colors
  "git://github.com/tpope/vim-vividchalk",              # more colors

  "git://github.com/digitaltoad/vim-jade",              # jade templating for node
  "git://github.com/tpope/vim-haml",
  "git://github.com/kchmck/vim-coffee-script",          # syntax highlighting for coffeescript
  "git://github.com/pangloss/vim-javascript",           # highlighting + syntax for JS
  "git://github.com/tpope/vim-markdown",

  "git://github.com/ervandew/supertab",                 # tab-complete anything
  "git://github.com/godlygeek/tabular",                 # align assignments and arg lists
  "git://github.com/mattn/gist-vim",
  "git://github.com/tomtom/tcomment_vim",               # comment any language
  "git://github.com/tpope/vim-endwise",                 # complete simple code structues
  "git://github.com/tpope/vim-repeat",                  # make . repeat the last whole plugin command
  "git://github.com/tsaleh/vim-matchit",
  "git://github.com/vim-scripts/mru.vim",               # navigate most-recently used files
  "git://github.com/mattn/webapi-vim"                   # required by Gist
]

# you should not need to touch anything below this line

# currently unused plugins:
# "git://github.com/tpope/vim-rails",
# "git://github.com/tpope/vim-surround",
# "git://github.com/tsaleh/vim-shoulda",
# "git://github.com/vim-ruby/vim-ruby",
# "git://github.com/vim-scripts/IndexedSearch",
# "git://github.com/vim-scripts/jQuery",

require 'fileutils'
require 'open-uri'

bundles_dir = File.expand_path("~/.vim/bundle")

FileUtils.cd(bundles_dir)

bundle_repo_urls.each do |url|
  dir = url.split('/').last.sub(/\.git$/, '')
  if File.directory?(dir)
    FileUtils.cd(dir)
    puts "Freshening vim plugin #{dir}"
    `git pull`
    FileUtils.cd("..")
  else
    puts "Cloning new vim plugin #{dir}"
    `git clone #{url} #{dir}`
  end
end

bundle_repo_urls.each{|d| d.gsub!(/git:\/\/\w+.com\/[\w-]+\/([\w\.-]+)$/, "\\1")}

Dir["*"].each do |dir|
  unless bundle_repo_urls.include?( dir )
    puts "Removing unused vim plugin #{dir}"
    FileUtils.rm_rf dir
  end
end
